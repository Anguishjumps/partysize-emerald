From 53a052829eec9bcf86c90df58ceff584f7a8167a Mon Sep 17 00:00:00 2001
From: charlotte <39415481+Anguishjumps@users.noreply.github.com>
Date: Wed, 14 Jan 2026 13:51:25 +0000
Subject: [PATCH 02/16] Control + PC Fix

- PC UI fix
- Party menu/PC controls fix
- Relearner, EVs and IV display enabled
- Follower mons enabled, affection disabled
- $1 rare candies in a few shops
---
 data/maps/MauvilleCity_Mart/scripts.inc  |   1 +
 data/maps/OldaleTown_Mart/scripts.inc    |   2 +
 data/maps/PetalburgCity_Mart/scripts.inc |   1 +
 data/maps/SlateportCity_Mart/scripts.inc |   1 +
 graphics/pokemon_storage/party_menu.bin  | Bin 528 -> 528 bytes
 include/config/battle.h                  |   2 +-
 include/config/overworld.h               |   2 +-
 include/config/summary_screen.h          |   8 +-
 src/data/items.h                         |   2 +-
 src/party_menu.c                         |  27 +++----
 src/pokemon_storage_system.c             |  95 +++++++++++++----------
 11 files changed, 79 insertions(+), 62 deletions(-)

diff --git a/data/maps/MauvilleCity_Mart/scripts.inc b/data/maps/MauvilleCity_Mart/scripts.inc
index f7028c20f8..0035e044d0 100644
--- a/data/maps/MauvilleCity_Mart/scripts.inc
+++ b/data/maps/MauvilleCity_Mart/scripts.inc
@@ -13,6 +13,7 @@ MauvilleCity_Mart_EventScript_Clerk::
 
 	.align 2
 MauvilleCity_Mart_Pokemart:
+	.2byte ITEM_RARE_CANDY
 	.2byte ITEM_POKE_BALL
 	.2byte ITEM_GREAT_BALL
 	.2byte ITEM_SUPER_POTION
diff --git a/data/maps/OldaleTown_Mart/scripts.inc b/data/maps/OldaleTown_Mart/scripts.inc
index 1e1aacbb10..ef9b067bd4 100644
--- a/data/maps/OldaleTown_Mart/scripts.inc
+++ b/data/maps/OldaleTown_Mart/scripts.inc
@@ -14,6 +14,7 @@ OldaleTown_Mart_EventScript_Clerk::
 
 	.align 2
 OldaleTown_Mart_Pokemart_Basic:
+	.2byte ITEM_RARE_CANDY
 	.2byte ITEM_POTION
 	.2byte ITEM_ANTIDOTE
 	.2byte ITEM_PARALYZE_HEAL
@@ -28,6 +29,7 @@ OldaleTown_Mart_ExpandedItems::
 
 	.align 2
 OldaleTown_Mart_Pokemart_Expanded:
+	.2byte ITEM_RARE_CANDY
 	.2byte ITEM_POKE_BALL
 	.2byte ITEM_POTION
 	.2byte ITEM_ANTIDOTE
diff --git a/data/maps/PetalburgCity_Mart/scripts.inc b/data/maps/PetalburgCity_Mart/scripts.inc
index 54ca3aa6d8..959b6ee3ff 100644
--- a/data/maps/PetalburgCity_Mart/scripts.inc
+++ b/data/maps/PetalburgCity_Mart/scripts.inc
@@ -14,6 +14,7 @@ PetalburgCity_Mart_EventScript_Clerk::
 
 	.align 2
 PetalburgCity_Mart_Pokemart_Basic:
+	.2byte ITEM_RARE_CANDY
 	.2byte ITEM_POKE_BALL
 	.2byte ITEM_POTION
 	.2byte ITEM_ANTIDOTE
diff --git a/data/maps/SlateportCity_Mart/scripts.inc b/data/maps/SlateportCity_Mart/scripts.inc
index ce7dd45b86..bc175aaa39 100644
--- a/data/maps/SlateportCity_Mart/scripts.inc
+++ b/data/maps/SlateportCity_Mart/scripts.inc
@@ -13,6 +13,7 @@ SlateportCity_Mart_EventScript_Clerk::
 
 	.align 2
 SlateportCity_Mart_Pokemart:
+	.2byte ITEM_RARE_CANDY
 	.2byte ITEM_POKE_BALL
 	.2byte ITEM_GREAT_BALL
 	.2byte ITEM_POTION
diff --git a/graphics/pokemon_storage/party_menu.bin b/graphics/pokemon_storage/party_menu.bin
index 973ef9e150d1ed67020e8006d86a352e74732c1d..7c4a4e96f89d49ee58ff89c3e5b9b79377fbb3fe 100644
GIT binary patch
delta 19
XcmbQhGJ$1++C)AHFbdhYDvc2UI?@IL

delta 13
VcmbQhGJ$1++Qfe?8&{<<0stm61+)MF

diff --git a/include/config/battle.h b/include/config/battle.h
index b5d11a9b3e..408460fe81 100644
--- a/include/config/battle.h
+++ b/include/config/battle.h
@@ -309,7 +309,7 @@
 #define B_MULTI_BATTLE_WHITEOUT         GEN_LATEST // In Gen4+, multi battles end when the Player and also their Partner don't have any more Pokémon to fight.
 #define B_EVOLUTION_AFTER_WHITEOUT      GEN_LATEST // In Gen6+, Pokemon that qualify for evolution after battle will evolve even if the player loses.
 #define B_WILD_NATURAL_ENEMIES          TRUE       // If set to TRUE, certain wild mon species will attack other species when partnered in double wild battles (eg. Zangoose vs Seviper)
-#define B_AFFECTION_MECHANICS           TRUE       // In Gen6+, there's a stat called affection that can trigger different effects in battle. From LGPE onwards, those effects use friendship instead.
+#define B_AFFECTION_MECHANICS           FALSE       // In Gen6+, there's a stat called affection that can trigger different effects in battle. From LGPE onwards, those effects use friendship instead.
 #define B_TRAINER_CLASS_POKE_BALLS      GEN_LATEST // In Gen7+, trainers will use certain types of Poké Balls depending on their trainer class.
 #define B_TRAINER_MON_RANDOM_ABILITY    FALSE      // If this is set to TRUE a random legal ability will be generated for a trainer mon
 #define B_OBEDIENCE_MECHANICS           GEN_LATEST // In PLA+ (here Gen8+), obedience restrictions also apply to non-outsider Pokémon, albeit based on their level met rather than actual level
diff --git a/include/config/overworld.h b/include/config/overworld.h
index b441862c2a..a8a6a5dd06 100644
--- a/include/config/overworld.h
+++ b/include/config/overworld.h
@@ -56,7 +56,7 @@
                                                   // 16x32, 32x32, 64x64 etc are fine
 #define OW_MON_WANDER_WALK             TRUE       // If true, OW pokemon with MOVEMENT_TYPE_WANDER will walk-in-place in between steps.
 // Follower Pokémon
-#define OW_FOLLOWERS_ENABLED           FALSE      // Enables follower Pokémon, HGSS style. Requires OW_POKEMON_OBJECT_EVENTS. Note that additional scripting may be required for them to be fully supported!
+#define OW_FOLLOWERS_ENABLED           TRUE      // Enables follower Pokémon, HGSS style. Requires OW_POKEMON_OBJECT_EVENTS. Note that additional scripting may be required for them to be fully supported!
 #define OW_FOLLOWERS_BOBBING           TRUE       // If TRUE, follower Pokémon will bob up and down during their idle & walking animations
 #define OW_FOLLOWERS_POKEBALLS         TRUE       // If TRUE, follower Pokémon will emerge from the Poké Ball they are stored in, instead of a normal Poké Ball
 #define OW_FOLLOWERS_WEATHER_FORMS     FALSE      // If TRUE, Castform and Cherrim gain FORM_CHANGE_OVERWORLD_WEATHER, which will make them transform in the overworld based on the weather.
diff --git a/include/config/summary_screen.h b/include/config/summary_screen.h
index e76cd478b6..74fe31e461 100644
--- a/include/config/summary_screen.h
+++ b/include/config/summary_screen.h
@@ -6,11 +6,11 @@
 #define P_SUMMARY_SCREEN_RENAME          TRUE   // If TRUE, an option to change Pokémon nicknames replaces the cancel prompt on the summary screen info page.
 
 // IV/EV settings
-#define P_SUMMARY_SCREEN_IV_EV_INFO      FALSE  // If TRUE, will allow player to cycle through the Stats, IVs, and EVs in the summary screen skills page.
+#define P_SUMMARY_SCREEN_IV_EV_INFO      TRUE  // If TRUE, will allow player to cycle through the Stats, IVs, and EVs in the summary screen skills page.
 #define P_SUMMARY_SCREEN_IV_EV_BOX_ONLY  FALSE  // If TRUE, will allow player to cycle through the Stats, IVs, and EVs in the summary screen skills page, but only in the PC storage box.
 #define P_SUMMARY_SCREEN_IV_HYPERTRAIN   TRUE   // If TRUE, stats that have been hyper trained will show as 31/S when viewing them in the summary screen
 #define P_SUMMARY_SCREEN_IV_EV_TILESET   FALSE  // If TRUE, loads an alternate tileset to allow changing the "STATS" label in the summary screen skills page. Note: if it's still loading the alternate tileset after changing this and recompiling, you may need a `make clean` before compilation.
-#define P_SUMMARY_SCREEN_IV_EV_VALUES    FALSE  // If TRUE, will show the actual IV value instead of the letter grade.
+#define P_SUMMARY_SCREEN_IV_EV_VALUES    TRUE  // If TRUE, will show the actual IV value instead of the letter grade.
 /*
 LETTER GRADE GUIDE:
 
@@ -27,7 +27,7 @@ Info taken from https://bulbapedia.bulbagarden.net/wiki/Stats_judge.
 #define P_SUMMARY_SCREEN_EV_ONLY         FALSE  // If TRUE, will only show EV info in the summary screen.
 
 // IV/EV flags
-#define P_FLAG_SUMMARY_SCREEN_IV_EV_INFO 0      // If this flag is set, will allow player to cycle through the Stats, IVs, and EVs in the summary screen skills page. Note: if P_SUMMARY_SCREEN_IV_EV_INFO is TRUE, this flag does nothing.
+#define P_FLAG_SUMMARY_SCREEN_IV_EV_INFO 1      // If this flag is set, will allow player to cycle through the Stats, IVs, and EVs in the summary screen skills page. Note: if P_SUMMARY_SCREEN_IV_EV_INFO is TRUE, this flag does nothing.
 
 // Move Relearner settings
 #define P_ENABLE_MOVE_RELEARNERS         FALSE   // If TRUE, it enables move relearners for egg, TM and tutor. (see below for specific configs /flags)
@@ -52,6 +52,6 @@ Info taken from https://bulbapedia.bulbagarden.net/wiki/Stats_judge.
 #define P_SUMMARY_MOVE_RELEARNER_FULL_PP TRUE   // If TRUE, the move relearner in the summary screen restores relearned moves' PP to full.
 
 // Move Relearner party menu
-#define P_PARTY_MOVE_RELEARNER           FALSE  // If TRUE, it enables the move relearner in the party menu.
+#define P_PARTY_MOVE_RELEARNER           TRUE  // If TRUE, it enables the move relearner in the party menu.
 
 #endif // GUARD_CONFIG_SUMMARY_SCREEN_H
diff --git a/src/data/items.h b/src/data/items.h
index ad019fdbd9..438bdb7538 100644
--- a/src/data/items.h
+++ b/src/data/items.h
@@ -2022,7 +2022,7 @@ const struct Item gItemsInfo[] =
     {
         .name = ITEM_NAME("Rare Candy"),
         .pluralName = ITEM_PLURAL_NAME("Rare Candies"),
-        .price = (I_PRICE >= GEN_7) ? 10000 : 4800,
+        .price = (I_PRICE >= GEN_7) ? 1 : 1,
         .description = COMPOUND_STRING(
             "Raises the level\n"
             "of a Pokémon by\n"
diff --git a/src/party_menu.c b/src/party_menu.c
index 254788e3ab..3610c560dc 100644
--- a/src/party_menu.c
+++ b/src/party_menu.c
@@ -1752,13 +1752,14 @@ static void UpdateCurrentPartySelection(s8 *slotPtr, s8 movementDir)
     }
 }
 
+//Charlotte Here
 static void UpdatePartySelectionSingleLayout(s8 *slotPtr, s8 movementDir)
 {
     // PARTY_SIZE + 1 is Cancel, PARTY_SIZE is Confirm
     switch (movementDir)
     {
     case MENU_DIR_UP:
-        if (*slotPtr == 0)
+        if (*slotPtr == 0 || *slotPtr == 1) //Top 2 Slots -> Loop to Cancel Button
         {
             *slotPtr = PARTY_SIZE + 1;
         }
@@ -1773,45 +1774,41 @@ static void UpdatePartySelectionSingleLayout(s8 *slotPtr, s8 movementDir)
             else
                 *slotPtr = gPlayerPartyCount - 1;
         }
-        else
+        else //Move Up
         {
-            (*slotPtr)--;
+            (*slotPtr)-=2;
         }
         break;
     case MENU_DIR_DOWN:
-        if (*slotPtr == PARTY_SIZE + 1)
+        if (*slotPtr == PARTY_SIZE + 1) //Hovering over cancel button -> Loop to top
         {
             *slotPtr = 0;
         }
         else
         {
-            if (*slotPtr == gPlayerPartyCount - 1)
+            if (*slotPtr == gPlayerPartyCount - 1 || (*slotPtr + 2 >= PARTY_SIZE)) //Last Party Slot -> move to confirm/cancel
             {
                 if (sPartyMenuInternal->chooseHalf)
                     *slotPtr = PARTY_SIZE;
                 else
                     *slotPtr = PARTY_SIZE + 1;
             }
-            else
+            else //Move Down
             {
-                (*slotPtr)++;
+                (*slotPtr)+=2;
             }
         }
         break;
     case MENU_DIR_RIGHT:
-        if (gPlayerPartyCount != 1 && *slotPtr == 0)
+        if ((*slotPtr % 2 == 0) && *slotPtr+1 < gPlayerPartyCount && *slotPtr != PARTY_SIZE && *slotPtr != PARTY_SIZE + 1)
         {
-            if (sPartyMenuInternal->lastSelectedSlot == 0)
-                *slotPtr = 1;
-            else
-                *slotPtr = sPartyMenuInternal->lastSelectedSlot;
+            *slotPtr += 1;
         }
         break;
     case MENU_DIR_LEFT:
-        if (*slotPtr != 0 && *slotPtr != PARTY_SIZE && *slotPtr != PARTY_SIZE + 1)
+        if ((*slotPtr % 2 != 0) && *slotPtr != PARTY_SIZE && *slotPtr != PARTY_SIZE + 1)
         {
-            sPartyMenuInternal->lastSelectedSlot = *slotPtr;
-            *slotPtr = 0;
+            *slotPtr -= 1;
         }
         break;
     }
diff --git a/src/pokemon_storage_system.c b/src/pokemon_storage_system.c
index baf083a0dc..34cc90d615 100644
--- a/src/pokemon_storage_system.c
+++ b/src/pokemon_storage_system.c
@@ -4174,19 +4174,21 @@ static void UpdateCloseBoxButtonFlash(void)
     }
 }
 
+
 static void SetPartySlotTilemaps(void)
 {
     u8 i;
 
-    // Skips first party slot, it should always be drawn
-    // as if it has a Pokémon in it
-    for (i = 1; i < PARTY_SIZE; i++)
+    for (i = 0; i < PARTY_SIZE; i++)
     {
         s32 species = GetMonData(&gPlayerParty[i], MON_DATA_SPECIES);
         SetPartySlotTilemap(i, species != SPECIES_NONE);
     }
 }
 
+//Charlotte Here
+static const u16 sPartySlotTile[PARTY_SIZE] = {49,55,85,91,121,127,157,163};
+
 static void SetPartySlotTilemap(u8 partyId, bool8 hasMon)
 {
     u16 i, j, index;
@@ -4197,9 +4199,8 @@ static void SetPartySlotTilemap(u8 partyId, bool8 hasMon)
     else
         data = sPartySlotEmpty_Tilemap;
 
-    index = 3 * (3 * (partyId - 1) + 1);
-    index *= 4;
-    index += 7;
+    index = (sPartySlotTile[partyId]);
+
     for (i = 0; i < 3; i++)
     {
         for (j = 0; j < 4; j++)
@@ -4731,21 +4732,25 @@ static void SetBoxMonIconObjMode(u8 boxPosition, u8 objMode)
         sStorage->boxMonsSprites[boxPosition]->oam.objMode = objMode;
 }
 
+//Charlotte Here
 static void CreatePartyMonsSprites(bool8 visible)
 {
     u16 i, count;
-    u16 species = GetMonData(&gPlayerParty[0], MON_DATA_SPECIES_OR_EGG);
-    u32 personality = GetMonData(&gPlayerParty[0], MON_DATA_PERSONALITY);
-
-    sStorage->partySprites[0] = CreateMonIconSprite(species, personality, 104, 64, 1, 12);
-    count = 1;
-    for (i = 1; i < PARTY_SIZE; i++)
+    u16 species;
+    u32 personality;
+    count = 0;
+    for (i = 0; i < PARTY_SIZE; i++)
     {
         species = GetMonData(&gPlayerParty[i], MON_DATA_SPECIES_OR_EGG);
+        personality = GetMonData(&gPlayerParty[i], MON_DATA_PERSONALITY);
         if (species != SPECIES_NONE)
         {
-            personality = GetMonData(&gPlayerParty[i], MON_DATA_PERSONALITY);
-            sStorage->partySprites[i] = CreateMonIconSprite(species, personality, 152,  8 * (3 * (i - 1)) + 16, 1, 12);
+            if (i%2 == 0) {
+                sStorage->partySprites[i] = CreateMonIconSprite(species, personality, 104,  8 * (3 * Div(i,2)) + 38, 1, 12);
+            }
+            else {
+                sStorage->partySprites[i] = CreateMonIconSprite(species, personality, 152,  8 * (3 * Div(i,2)) + 38, 1, 12);
+            }
             count++;
         }
         else
@@ -4805,15 +4810,16 @@ static u8 GetNumPartySpritesCompacting(void)
 #define sSpeedY    data[5]
 #define sMoveSteps data[6]
 
+//Charlotte Here
 static void MovePartySpriteToNextSlot(struct Sprite *sprite, u16 partyId)
 {
     s16 x, y;
 
     sprite->sPartyId = partyId;
-    if (partyId == 0)
-        x = 104, y = 64;
+    if (partyId % 2 == 0)
+        x = 104, y = 8 * (3 * Div(partyId,2)) + 38;
     else
-        x = 152, y = 8 * (3 * (partyId - 1)) + 16;
+        x = 152, y = 8 * (3 * Div(partyId,2)) + 38;
 
     sprite->sMonX = (u16)(sprite->x) * 8;
     sprite->sMonY = (u16)(sprite->y) * 8;
@@ -4835,15 +4841,15 @@ static void SpriteCB_MovePartyMonToNextSlot(struct Sprite *sprite)
     }
     else
     {
-        if (sprite->sPartyId == 0)
+        if (sprite->sPartyId % 2 == 0)
         {
             sprite->x = 104;
-            sprite->y = 64;
+            sprite->y = 8 * (3 * Div(sprite->sPartyId,2)) + 38;
         }
         else
         {
             sprite->x = 152;
-            sprite->y = 8 * (3 * (sprite->sPartyId - 1)) + 16;
+            sprite->y = 8 * (3 * Div(sprite->sPartyId,2)) + 38;
         }
         sprite->callback = SpriteCallbackDummy;
         sStorage->partySprites[sprite->sPartyId] = sprite;
@@ -5830,6 +5836,7 @@ static void InitCursorOnReopen(void)
     }
 }
 
+//Charlotte Here
 static void GetCursorCoordsByPos(u8 cursorArea, u8 cursorPosition, u16 *x, u16 *y)
 {
     switch (cursorArea)
@@ -5839,20 +5846,20 @@ static void GetCursorCoordsByPos(u8 cursorArea, u8 cursorPosition, u16 *x, u16 *
         *y = (cursorPosition / IN_BOX_COLUMNS) * 24 +  32;
         break;
     case CURSOR_AREA_IN_PARTY:
-        if (cursorPosition == 0)
-        {
-            *x = 104;
-            *y = 52;
-        }
-        else if (cursorPosition == PARTY_SIZE)
+        if (cursorPosition == PARTY_SIZE)
         {
             *x = 152;
             *y = 132;
         }
+        else if (cursorPosition % 2 == 0)
+        {
+            *x = 104;
+            *y = Div(cursorPosition,2) * 24 + 26;
+        }
         else
         {
             *x = 152;
-            *y = (cursorPosition - 1) * 24 + 4;
+            *y = Div(cursorPosition,2) * 24 + 26;
         }
         break;
     case CURSOR_AREA_BOX_TITLE:
@@ -7371,6 +7378,7 @@ static u8 InBoxInput_MovingMultiple(void)
     }
 }
 
+//Charlotte Here
 static u8 HandleInput_InParty(void)
 {
     u8 retVal;
@@ -7390,35 +7398,42 @@ static u8 HandleInput_InParty(void)
 
         if (JOY_REPEAT(DPAD_UP))
         {
-            if (--cursorPosition < 0)
+            if (cursorPosition == PARTY_SIZE)
+                cursorPosition -= 1;
+            else if ((cursorPosition -2) < 0)
                 cursorPosition = PARTY_SIZE;
-            if (cursorPosition != sCursorPosition)
-                retVal = INPUT_MOVE_CURSOR;
+            else
+                cursorPosition -= 2;
+
+            retVal = INPUT_MOVE_CURSOR;
             break;
         }
         else if (JOY_REPEAT(DPAD_DOWN))
         {
-            if (++cursorPosition > PARTY_SIZE)
-                cursorPosition = 0;
-            if (cursorPosition != sCursorPosition)
-                retVal = INPUT_MOVE_CURSOR;
+            if (cursorPosition == PARTY_SIZE)
+                cursorPosition = 1;
+            else if ((cursorPosition + 2) >= PARTY_SIZE)
+                cursorPosition = PARTY_SIZE;
+            else
+                cursorPosition += 2;
+
+            retVal = INPUT_MOVE_CURSOR;
             break;
         }
-        else if (JOY_REPEAT(DPAD_LEFT) && sCursorPosition != 0)
+        else if (JOY_REPEAT(DPAD_LEFT) && (sCursorPosition % 2 != 0)) //Right Column
         {
             retVal = INPUT_MOVE_CURSOR;
-            sStorage->cursorPrevHorizPos = sCursorPosition;
-            cursorPosition = 0;
+            cursorPosition -= 1;
             break;
         }
         else if (JOY_REPEAT(DPAD_RIGHT))
         {
-            if (sCursorPosition == 0)
+            if (sCursorPosition % 2 == 0) //Left Column
             {
                 retVal = INPUT_MOVE_CURSOR;
-                cursorPosition = sStorage->cursorPrevHorizPos;
+                cursorPosition += 1;
             }
-            else
+            else //If on Right Column, exit party menu
             {
                 retVal = INPUT_HIDE_PARTY;
                 cursorArea = CURSOR_AREA_IN_BOX;
-- 
2.52.0.windows.1

